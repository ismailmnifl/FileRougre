<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- addons -->
    <link rel="stylesheet" href="addOns/navbar.css">
    <link rel="stylesheet" href="addOns/footer.css">

    <!-- custom styles -->
    <link rel="stylesheet" href="blogHome.css">
    <title>DoctorCO | Blog Home</title>
</head>
<body>
    <header id="header"></header>

    
    	<!-- to keep the header away from the content -->
		<div class="spacer"></div>
		<!-- bage heading -->
		<div class="headerTitle">
			<h1 class="heading">
				<span>'</span>Bloge Space<span>'</span>
			</h1>
		</div>
        <section class="filterSection">
			<div class="filter">
				<!--  -->
				<div class="input-group">
					<select id="specialities" class="form-select form-control">
						<option disabled selected>Speciality Filter</option>
					  </select>				  
					</div>
				  <div class="input-group">
					<select id="locations" class="form-select form-control" aria-label="Default select example">
						<option disabled selected>Location Filter</option>
						
					  </select>				 
					 </div>
					<div class="input-group">
						<input id="search" type="text"  placeholder="Search..." class="form-control">
						<button class="buttonReverse">Search</button>
                        <ul id="autocompleteList"> 
                        </ul>
					  </div>
				
			</div>
		</section>
        <section class="post" id="post">
			<div class="container min-vh-100">

				<div id="postWrapper" class="box-container">
					
				</div>
			</div>
		</section>
    <footer id="footer"></footer>
    <!-- boostrap pooper and js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jquery cdn link  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- addons -->
    <script src="js/addOns.js"></script>
    <script>
        /* eventListeners binded with dom */
        window.addEventListener('load',getAllPosts);
        document.getElementById('search').addEventListener('keyup',search);
/* *********************************************************************************** */

        function getAllPosts() {
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            redirect: 'follow'
            };

            fetch("http://localhost/fileRouge/post/getAllPosts", requestOptions)
            .then(response => response.text())
            .then(function(result) {
                console.log(result);
                var data = JSON.parse(result);
                data.forEach(element => {
                   var preview = element.body.slice(0, 60)+'...';

                    document.getElementById('postWrapper').innerHTML +=`
                    <div class="box" data-aos="fade-right">
                        <img src="../uploads/${element.image}" alt="">
                        <div class="content">
							<span>${element.dateCreated}</span>
							<h4>${element.title}</h4>
							<p>
								${preview}
							</p>
							<a onclick="getSelectedPost(${element.post_id})" href="Post.html"
								><button  class="button">learn more</button></a
							>
						</div>
					</div>
                    `;
                });
            })
            .catch(error => console.log('error', error));
        }
/* *********************************************************************************** */
        function fillSearchInput(id) {
           var value =  document.getElementById("element-"+id).innerHTML;
           console.log(value);
            document.getElementById('search').value = value;
        }
/* *********************************************************************************** */

        function search() {
           var inputSearchValue = document.getElementById('search').value;
            if (inputSearchValue == "") {
                document.getElementById('autocompleteList').style.display = "none";
            }else {
                document.getElementById('autocompleteList').style.display = "block";
                
                var myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");

                var raw = JSON.stringify({
                "title": document.getElementById('search').value,
                });

                var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
                };

                fetch("http://localhost/fileRouge/post/search", requestOptions)
                .then(response => response.text())
                .then(function(result) {

                console.log(result);
                var data = JSON.parse(result);
                console.log(data);
                document.getElementById('autocompleteList').innerHTML = "";
                data.forEach(element => {
                    document.getElementById('autocompleteList').innerHTML += `
                        <li onclick="fillSearchInput(${element.post_id})" id="element-${element.post_id}">${element.title}</li>
                    `; 
                });
            })
            .catch(error => console.log('error', error));
            }
            
        }
        function getSelectedPost(id) {
				sessionStorage.setItem('postID', id);
					console.log(sessionStorage.getItem('postID'));
				return sessionStorage.getItem('postID');
			}
    </script>

</body>
</html>